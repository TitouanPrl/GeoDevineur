<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" th:href="@{/resources/static/css/bootstrap.min.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/resources/static/css/header.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/resources/static/css/modal.css}">
</head>
<body onkeydown="checkKey(event)">
<header>
    <div class="navbar navbar-dark bg-dark box-shadow">
        <div class="container d-flex justify-content-between">
            <a href="/" class="navbar-brand d-flex align-items-center">
                <img class="" width="140" height="90" th:src="@{/resources/static/img/logo.png}" alt="">
                <h2>GéoDevineur</h2>
            </a>
            <a href="quizz?waiting=true" class="navbar-brand d-flex align-items-center"><h4>Quizz</h4></a>
            <a href="apprendre" class="navbar-brand d-flex align-items-center"><h4>Apprendre</h4></a>
            <a href="regles" class="navbar-brand d-flex align-items-center"><h4>Règles</h4></a>
            <a href="scores" class="navbar-brand d-flex align-items-center"><h4>Meilleurs scores</h4></a>
        </div>
    </div>
</header>
<button id="add">AJOUTER</button>
<div th:remove="tag" th:utext="${startButton}"></div>
<div class="modal" id="formScoreModal">
    <div class="modal-content">
        <span class="close" id="closeModal" onclick="closeModal()">&times;</span>
        <h2>Bien joué, vous avez fait un score de <b>1300</b></h2>
        <form id="saveScore" onsubmit="proceedForm()">
            <div class="form-group">
                <label for="pseudo">Pseudo</label>
                <input type="text" class="form-control" id="pseudo" aria-describedby="emailHelp" placeholder="Saisissez votre pseudo" required>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="text" class="form-control" id="password" placeholder="Saisissez votre code confidentiel">
            </div>
            <input type="hidden" id="seconds" value="100">
            <input type="hidden" id="nb" value="7">
            <button type="submit" class="btn btn-primary">Enregistrer</button>
        </form>
    </div>
</div>
<div class="col-md-4 container" style="padding: 1%" th:remove="tag" th:utext="${questionContent}">

</div>

<script>
    function proceedForm() {
        const pseudo = document.getElementById("pseudo").value;
        const password = document.getElementById("password").value;
        const nb = document.getElementById("nb").value;
        const seconds = document.getElementById("seconds").value;

        window.location.assign("http://localhost:8080/scores?pseudo="+pseudo+"&password="+password+"&seconds="+seconds+"&nb="+nb);
        alert('done');
    }

    document.getElementById("add").addEventListener("click", function() {
        window.location.assign("quizz?fin=true");
    });

    document.getElementById("start").addEventListener("click", function() {
        window.location.assign("quizz?start=true");
    });

    //----------MODAL−CALL------------------------------

    // Fonction pour vérifier si l'URL contient "fin=true"
    function urlContainsFin() {
        const params = new URLSearchParams(window.location.search);
        return params.get("fin") === "true";
    }

    // Fonction pour vérifier si l'URL contient "nextQ=true"
    function urlContainsNextQ() {
        const params = new URLSearchParams(window.location.search);
        return params.get("nextQ") === "true";
    }

    // Fonction pour afficher le modal si l'URL contient "fin=true"
    function displayModal() {
        const modal = document.getElementById("formScoreModal");
        if (urlContainsFin()) {
            modal.style.display = "block";
        }
    }

    // Fermer le modal lorsqu'on clique sur la croix OU appuie sur Echap
    function closeModal(){
        const modal = document.getElementById("formScoreModal");
        cleanURL();
        modal.style.display = "none";
    }

    //Verification que la touche pressée est Echap
    function checkKey(event){
        let keynum;
        //Recuperation de la touche suivant les differents naviguateur
        if(window.event) keynum = event.keyCode;
        else if(event.which) keynum = event.which;
        if (keynum === 27) closeModal();
    }

    //Enleve tous les parametres de l'url
    function cleanURL(){
        window.history.replaceState({}, document.title, window.location.pathname);
    }

    if(urlContainsNextQ()){
        //window.location.assign("http://localhost:8080/quizz");
    }

    // Appeler la fonction pour afficher le modal au chargement de la page
    displayModal();
</script>
<footer class="text-muted border-top" style="padding-top: 15px">
    <div class="container text-center">
        <p>Site créé dans le cadre d'un projet JEE</p>
        <p><a href="https://github.com/TitouanPrl/GeoDevineur" class="nav-link">Github GéoDevineur</a></p>
    </div>
</footer>
</body>
</html>